<div class="chart-container">
  <div *ngIf="currentChartType && !chartError" class="chart-type-title">
    <h2>{{currentChartType}} Chart</h2>
  </div>
  <highcharts-chart
    *ngIf="!chartError && !showTreemapContainer && chartOptions.series && chartOptions.series.length"
    [Highcharts]="Highcharts"
    [options]="chartOptions"
    [update]="updateFlag"
    [oneToOne]="true"
    [runOutsideAngular]="false"
    [key]="chartKey"
    style="width: 100%; height: 400px; display: block"
  ></highcharts-chart>

  <div *ngIf="!chartError && showTreemapContainer" class="treemap-container">
    <div class="treemap-header">
      <h3>{{ currentChartType}} - Global Market Share by Company</h3>
      <p class="treemap-subtitle">
        Interactive {{ currentChartType | titlecase }} Visualization
      </p>
    </div>

    <div class="treemap-chart-wrapper">
      <div class="recharts-wrapper" style="width: 100%; height: 400px">
        <div class="treemap-placeholder">
          <div class="treemap-grid">
            <div
              *ngFor="let item of treemapData; let i = index"
              class="treemap-cell"
              [style.background-color]="item.color"
              [style.flex-basis.%]="item.value"
              [attr.data-tooltip]="item.name + ': ' + item.value + '%'"
            >
              <span class="cell-label" *ngIf="item.value > 5">
                {{ item.name }}<br />{{ item.value }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="treemap-legend">
      <div class="legend-items">
        <div *ngFor="let item of treemapData" class="legend-item">
          <div class="legend-color" [style.background-color]="item.color"></div>
          <span class="legend-label">{{item.name}} ({{item.value}}%)</span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="chartError" class="error-msg">
    <h2>Error fetching chart details</h2>
    <p>There was a problem rendering this chart type. Please try another.</p>
  </div>

  <div *ngIf="!currentChartType && !chartError" class="no-chart-msg">
    <h2>No chart selected</h2>
    <p>Please choose a chart type from the sidebar.</p>
  </div>
</div>
